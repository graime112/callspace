# üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email –¥–ª—è CallSpace

## –û–±–∑–æ—Ä

CallSpace —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É email –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ HTML —à–∞–±–ª–æ–Ω–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–µ—Ä–≤–∏—Å.

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gmail (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é** –≤ –≤–∞—à–µ–º Google –∞–∫–∫–∞—É–Ω—Ç–µ
2. **–°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google App Passwords](https://myaccount.google.com/apppasswords)
   - –í—ã–±–µ—Ä–∏—Ç–µ "Mail" –∏ "Other (Custom name)"
   - –í–≤–µ–¥–∏—Ç–µ "CallSpace" –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω–∏–µ
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å

3. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env:**
   ```bash
   cp email-config.example .env
   ```

4. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env:**
   ```env
   EMAIL_USER=your-email@gmail.com
   EMAIL_PASS=your-16-character-app-password
   ```

5. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   ./restart-server.sh
   ```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

#### Outlook/Hotmail
```env
EMAIL_USER=your-email@outlook.com
EMAIL_PASS=your-password
```

#### Yandex
```env
EMAIL_USER=your-email@yandex.ru
EMAIL_PASS=your-password
```

#### Mail.ru
```env
EMAIL_USER=your-email@mail.ru
EMAIL_PASS=your-password
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
curl http://localhost:3000/api/email/config
```

### 2. –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ email
```bash
node test-email.js
```

### 3. –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/admin.html`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å email (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚úÖ)
3. –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email

## üìß –ß—Ç–æ –ø–æ–ª—É—á–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

### HTML Email —Å:
- üé® –ö—Ä–∞—Å–∏–≤—ã–º –¥–∏–∑–∞–π–Ω–æ–º
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å—Ç–∫–æ–π
- üîó –ü—Ä—è–º–æ–π —Å—Å—ã–ª–∫–æ–π –¥–ª—è –≤—Ö–æ–¥–∞
- üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–µ—Ä–≤–∏—Å–µ
- üë§ –î–∞–Ω–Ω—ã–º–∏ –¥–ª—è –≤—Ö–æ–¥–∞

### –¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
- –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ HTML —à–∞–±–ª–æ–Ω–∞
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `createInvitationTemplate` –≤ `server/email-service.js`:

```javascript
function createInvitationTemplate(userData, inviteUrl) {
    // –í–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π HTML –∑–¥–µ—Å—å
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–∏—Å—å–º–∞
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `mailOptions.text` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `sendInvitationEmail`.

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "Email not configured"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `EMAIL_USER` –∏ `EMAIL_PASS` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

### "Authentication failed"
- –î–ª—è Gmail: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ App Password, –Ω–µ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ "Less secure app access" –≤–∫–ª—é—á–µ–Ω (–¥–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤)

### "Connection timeout"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SMTP –ø–æ—Ä—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π email –ø—Ä–æ–≤–∞–π–¥–µ—Ä

### "Invalid email format"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç email –∞–¥—Ä–µ—Å–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤

## üìã API Endpoints

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
GET /api/email/config
```

### –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
POST /api/users/invite
Content-Type: application/json

{
    "email": "user@example.com",
    "name": "User Name",
    "inviterId": "admin"
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ñ–∞–π–ª .env** –≤ git
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ App Passwords** –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** –ø–∞—Ä–æ–ª–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
EMAIL_USER=your-email@example.com
EMAIL_PASS=your-password

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
PORT=3000
NODE_ENV=production
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç:
- ‚úÖ –£—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É email
- ‚ùå –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
- üìß –î–µ—Ç–∞–ª–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π

### –°—Ç–∞—Ç—É—Å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- ‚úÖ Email –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚ùå Email –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚ùì –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
```javascript
const response = await fetch('/api/users/invite', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        email: 'newuser@example.com',
        name: 'New User',
        inviterId: 'admin'
    })
});

const result = await response.json();
console.log('Email sent:', result.emailSent);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ email
```javascript
const response = await fetch('/api/email/config');
const config = await response.json();
console.log('Email configured:', config.configured);
```

## üöÄ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `SMTP_CONFIG` –≤ `server/email-service.js` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.

### –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ñ–æ–Ω–µ
–î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π (Redis, Bull).

### –®–∞–±–ª–æ–Ω—ã –ø–æ —è–∑—ã–∫–∞–º
–î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤ –≤ —à–∞–±–ª–æ–Ω—ã email.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `node test-email.js`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
