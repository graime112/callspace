#!/bin/bash

# Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ° CallSpace

echo "ğŸ”„ Restarting CallSpace server..."

# ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑ‹
echo "â¹ï¸ Stopping existing server processes..."
pkill -f "node server.js" 2>/dev/null || echo "No existing server processes found"

# Ğ–Ğ´ĞµĞ¼ Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾
sleep 2

# ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ ÑĞµÑ€Ğ²ĞµÑ€Ğ°
cd "$(dirname "$0")/server"

# Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑĞµÑ€Ğ²ĞµÑ€
echo "ğŸš€ Starting server..."
node server.js &

# Ğ–Ğ´ĞµĞ¼ Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°
sleep 3

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ğ»ÑÑ
if curl -s http://localhost:3000/api/users > /dev/null; then
    echo "âœ… Server started successfully!"
    echo "ğŸŒ Admin panel: http://localhost:3000/admin.html"
    echo "ğŸ’¬ Messenger: http://localhost:3000/messenger.html"
    echo "ğŸ  Home: http://localhost:3000/"
else
    echo "âŒ Server failed to start"
    exit 1
fi
